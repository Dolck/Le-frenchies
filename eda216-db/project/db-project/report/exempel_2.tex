%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Detta är ett exempel på ett latexdokument.
% 
% Alla dokument består av följande delar:
%
%          \documentclass[optioner]{dokumentklass}
%            ...inställningar...
%          \begin{document}
%            ...text...
%          \end{document}
%
% Som ni kanske redan har förstått är används procent (%) för
% kommentarer.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[a4paper]{article}

\usepackage{graphicx}
\usepackage{listings}
\usepackage{indentfirst}
\usepackage{float}
%\usepackage[T1]{fontenc}                % För svenska bokstäver
%\usepackage[swedish]{babel}             % För svensk avstavning och svenska
                                        % rubriker (t ex "innehållsförteckning)
\title{Programming Project, Database Technology}
\author{Tim Dolck dat11tdo@student.lu.se \\ 
Julian Kroné dat11jkr@student.lu.se \\
Christopher Nilsson dat11cni@student.lu.se}
%\date{}           % Blir dagens datum om det utelämnas

\begin{document}
\lstset{language=SQL}

\maketitle                      % Skriver ut rubriken som vi
                                % deklarerade ovan med \title, \author
                                % och eventuellt \date
\newpage
\section{Introduction}          % Detta kommando gör en rubrik

\section{Requirements}

Krusty Cookies database system is built with the simplest possible interface to make sure all employees are able to use it. 
The system is also very stable and the bugs are very few. 

At this point the system is only a test system with all aspects of production implemented although the database is prepared for future development!
So far the system can be used to search/filter pallets, create pallets and block pallets.
When a pallet is created the database of rawmaterials is updated according to the cookietype of the pallet created.
When searching/filtering pallets several parameters can be used such as id-number, production time and status. 

\section{Outline}
Our product is built in play framework. It is a web application framework with support for programming in scala. Play also enables us to easy use a model-view-controller modell, which we have. The view section is mostly built up by html-templates. These templates are filled up with data from scala-variables. The model \& controller section are both written in scala. 

The product uses jdbc as databasemanager. The controller section of the program has the connection with the database. It handles all the SQL-queries and sends them to the database. For every method the controller sets up a connection with the database, sends the queries, gets the result and closes the connection.

\section{Model}

\subsection{E/R Diagram}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{cookies.png}
  \caption{An UML diagram illustrating the database design.}
  \label{model}
\end{figure}

\subsection{Relations}

\noindent
RawMaterials(\underline{rawType}, quantity, unitOfM, lastDelivDate, lastDelivQ) \\
CookieNames(\underline{cookieName}) \\
RecipeDetails(\underline{\emph{rawType, cookieName}}, quantity) \\
Pallets(\underline{id}, prodTime, Status, \emph{cookieName, orderId}) \\
Customers(\underline{cName, cAddress}) \\
Orders(\underline{orderId}, nbrPallets, incomeDate, delivDate, \emph{cName, cAddress}) \\
OrderDetails(\underline{\emph{orderId, cookieName}}, nbrPallets)
\indent

Since there are no relations other than those provided by the primary keys, the relations are in BCNF.

\section{Statements}

\begin{lstlisting}[frame=single]
--
-- Disable foreign key checks temporarily so 
-- tables can be deleted in arbitrary order, 
-- and so that insertion is faster.

set FOREIGN_KEY_CHECKS = 0;

-- Drop the tables if they already exist.

drop table if exists RawMaterials;
drop table if exists RecipeDetails;
drop table if exists CookieNames;
drop table if exists Pallets;
drop table if exists OrderDetails;
drop table if exists Orders;
drop table if exists Customers;

-- Create the tables.

create table RawMaterials (
    rawType     varchar(30) not null,
    quantity    integer default 100000000 
      check (quantity >= 0),
    unitOfM     enum('g', 'ml') not null,
    lastDeliv   datetime,
    lastDelivQ  integer,
    primary key (rawType)
);

create table RecipeDetails (
    cookieName  varchar(20) not null,
    rawType     varchar(30) not null,
    quantity    integer not null,
    primary key (cookieName, rawType),
    foreign key (cookieName) references 
      CookieNames(cookieName),
    foreign key (rawType) references 
      RawMaterials(rawType)
);

create table CookieNames (
    cookieName  varchar(20) not null,
    primary key (cookieName)
);

create table Pallets (
    id          integer auto_increment,
    prodTime    datetime not null,
    cookieName  varchar(20) not null,
    status      enum('free','blocked','ordered','delivered') 
      not null default 'free',
    orderId     integer default null,
    primary key (id),
    foreign key (cookieName) references 
      CookieNames(cookieName),
    foreign key (orderId) references 
      OrderDetails(orderId)
);

create table Customers (
    cName       varchar(30) not null,
    cAddress    varchar(30) not null,
    primary key (cName, cAddress)
);

create table Orders (
    orderId     integer auto_increment,
    nbrPallets  integer not null check (nbrPallets > 0),
    incomeDate  datetime not null,
    delivDate   datetime not null,
    cName       varchar(30) not null,
    cAddress    varchar(30) not null,
    primary key (orderId),
    foreign key (cName, cAddress) references 
      Customers(cName, cAddress)
);

create table OrderDetails (
    orderId     integer not null,
    cookieName  varchar(20) not null,
    nbrPallets  integer not null check (nbrPallets >= 0),
    primary key (orderId, cookieName),
    foreign key (orderId) references Orders(orderId),
    foreign key (cookieName) references 
      CookieNames(cookieName)
);
\end{lstlisting}


\section{Manual}

\subsection{Starting the program}
The system is delivered as a compressed zip file.
To decompress it use the built-in decompress features in your operating system of choice.
\paragraph{Example:}
On a unix system run the following command:
\begin{lstlisting}[frame=single]  % Start your code-block

> unzip krusty.zip
\end{lstlisting}

To run the system Java and Typesafe Reactive Platform is used. If you don't have them installed, install them now.
Inside your unzipped folder there is a folder named bin. Go there.
To run the program type the following:
\paragraph{Unix:}
(in the bin folder)
\begin{lstlisting}[frame=single]  % Start your code-block

> ./db-project
\end{lstlisting}

\paragraph{Windows:}
(in the bin folder)

\begin{lstlisting}[frame=single]  % Start your code-block

> db-project.bat
\end{lstlisting}

This will output a port in the terminal that you can later used to use the system in a browser of your choice.


\subsection{Using the system}
If running on a local system, open localhost:port in your browser. Otherwise replace localhost by an ip-address.
\subsubsection{List/filter pallets}
To view all pallets in the database, press the button named "List pallets".
To filter/search for pallets you can use the form on the top of the page.

\subsubsection{Create a pallet to an existing order}
To create a pallet to an existing order press "Create pallet to existing order".
Choose the order you want to create a pallet in.
Then choose the cookie type you want the pallet to have. Done! The pallet is created!

\subsubsection{Create a pallet without an existing order}
To create a pallet without and existing order associated to it press "Create pallet without order".
Then choose the cookie type of choice. Done! The pallet is created!

\end{document}                 % The input file ends with this command.
